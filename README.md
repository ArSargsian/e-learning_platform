# Analysis of the new payment system on the e-learning platform

## Цель 
В ходе A/B–тестирования гипотезы целевой группе была предложена новая механика оплаты услуг на сайте, у контрольной группы оставалась базовая механика. Необходимо проанализировать итоги эксперимента и сделать вывод, стоит ли запускать новую механику оплаты на всех пользователей.

##  Стек технологий
- Python  
- ClickHouse  
- SQL 
- Jupyterhub  
- Библиотеки: pandas, pandahouse, numpy, matplotlib.pyplot, seaborn, scipy.stats, statsmodels.api

## Данные
groups.csv - файл с информацией о принадлежности пользователя к контрольной или экспериментальной группе (А – контроль, B – целевая группа)

groups_add.csv - дополнительный файл с пользователями, который прислали спустя 2 дня после передачи данных

active_studs.csv - файл с информацией о пользователях, которые зашли на платформу в дни проведения эксперимента

checks.csv - файл с информацией об оплатах пользователей в дни проведения эксперимента. 

## Задачи
- Определить необходимые метрики для анализа 
- Проанализировать различия в показателях и проверить их на статистическую значимость
- Выяснить, стоит ли запускать новую механику на всех пользователей

В анализе будем использовать следующие метрики:
1. **конверсию из вхождения на сайт в покупку**. Применим критерий **Хи-квадрат** и сформулируем нулевую гипотезу следующим образом: 
<blockquote>Наши переменные (конверсии) в двух группах независимы, и распределение значений в этих группах относительно одинаковые</blockquote>

2. **среднее значение суммы покупок только платящих пользователей**. Тем самым, мы сравниваем <i>ARPPU</i> в контрольной и тестовой группе. Здесь можно использовать несколько критериев. Мы будем использовать **Bootstrap**, так как для t-критерия Стьюдента соблюдаются не все условия, что может привести к не самым точным результатам. 

По итогу наша нулевая гипотеза будет следующая:
<blockquote>Средние значения суммы покупок для платящих пользователей в двух группах не отличаются</blockquote>

3. **среднее значения суммы покупки всех пользователей, участвовавших в день проведения эксперимента**. То есть, мы будем сравнивать <i>ARPU</i>.


## Итоги
1. **конверсию из вхождения на сайт в покупку**. 
P value = 0.45
По результату критерия **Хи-квадрат** (берем уровень альфа, равным 5%), мы не можем отклонить нулевую гипотезу, что наши распределения конверсий в 2-х группах относительно одинаковы. Это значит, что скорее всего, новая механика не влияет на то, решится ли пользователь что-то купить или нет.

2. **среднее значение суммы покупок только платящих пользователей** <i>ARPPU</i> в контрольной и тестовой группе. 
Так как P-значение  = 0.00000179 и значительно меньше 0.05, мы можем сказать, что различия в средних наших выборок есть и они стат.значимы. С точки зрения бизнеса, это можно интерпретировать так:
новая механика оплаты влияет на то, сколько пользователь решит потратить на покупку.

3. **среднее значения суммы покупки всех пользователей, участвовавших в день проведения эксперимента** <i>ARPU</i>.
 p-value = 0.041 показывает результат ниже 5%, что позволяет нам утверждать, что средние в двух группах отличаются стат.значимо. 

При тестировании **конверсии** с помощью критерия *Хи-квадрат* результат не дал стат.значимых различий. Однако, при сравнении **ARPPU** и **ARPU** мы получили результат, который показывает, что эти показатели стат.значимо отличаются в контрольной и тестовой группах.

### Вывод:
Мы можем утвердить новую механику оплаты услуг на сайте и ожидать увеличения среднего чека наших покупателей.

## 2. SQL
#### 2.1 
Образовательные курсы состоят из различных уроков, каждый из которых состоит из нескольких заданий. 

Вывести учеников с различных курсов на платформе, которые хотя бы раз за текущий месяц правильно решили 20 заданий.

#### 2.2 Оптимизация воронки
Даны таблицы default.peas, default.studs и default.final_project_check.

На образовательной платформе студентам можно проходить курсы по модели trial: только 30 заданий в день бесплатно. Для неограниченного количества заданий по дисциплине студенту нужно приобрести полный доступ. 
Проанализируем результаты эксперимента с новым экраном оплаты.

Для этого выгрузим в одном запросе следующую информацию о группах пользователей:
- ARPU (доход / кол-во пользователей)
- ARPAU (доход / кол-во активных пользователей)
- CR в покупку (пользователи, которые сделали покупку / общее кол-во пользователей)
- СR активного пользователя в покупку 
- CR пользователя из активности по математике (subject = ’math’) в покупку курса по математике 
Активным будем считать пользователя, за все время решившего больше 10 задач правильно в любых дисциплинах.

Активным по математике будет пользователь, за все время решивший 2 или больше задач правильно по математике.

### Задание 3. Python
#### Достижения
- Реализовал функцию, которая будет автоматически подгружать информацию из дополнительного файла groups_add.csv и на основании дополнительных параметров пересчитывать метрики.
- Написал функцию, которая будет строить графики по получаемым метрикам.
